<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8' />
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<link href='lib/main.css' rel='stylesheet' />
<link href='lib/common.css' rel='stylesheet' />
<link href='lib/tutor-interface.css' rel='stylesheet' />
<link rel="icon" type="image/x-icon" href="assets/lingyang-favicon2.ico">
<script src='lib/main.js'></script>
<script src='lib/locales/zh-cn.js'></script>
<script src="lib/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/faunadb@latest/dist/faunadb.js"></script>
<script src="lib/fauna-api.js"></script>
<script src="lib/wxpusher-api.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script> -->
<script src="lib/moment.min.js"></script>
<script src="lib/moment-timezone-with-data.min.js"></script>
<script src="lib/moment-api.js"></script>

<script>
  window.mobilecheck = function() {
  var check = false;
    (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
    return check;
  };
</script>

<!-- <script type="module">
  import * as momentTimeZone from './lib/moment-timezone-with-data.min.js';
</script> -->

<script>
  let code = "";
  let uid = localStorage.getItem('tutor_uid') ? localStorage.getItem('tutor_uid') : "";
  let tutor_name = "";
  let bookedEventsData = [];
  let adminEventsData = [];
  let hiddenDays = [];
  let calendar = null;
  let calendar2 = null;
  let saveBtnAdded = false;
  let adminEvents = [];
  let displayedAdminEvents = [];
  let adminChinaEvents = [];
  let configCurrentDay = null;
  let copyEvents = [];
  let copyChinaEvents = [];
  let veryStartISOstr = null;
  let startISOstr = null;
  let endISOstr = null;
  let courseTypeList = [];
  let studentNameList = [];
  let filterCourseType = "所有课程";
  let filterStudentName = "所有学员";
  let dbIdToDelete = null;
  let adminEventsLen = 0;
  let currentPanel = "panel1";
  const veryStart = new Date(new Date().setMonth(new Date().getMonth() - 3));
  const monthStart = new Date(new Date().setMonth(new Date().getMonth()));
  const monthEnd = new Date(new Date().setMonth(new Date().getMonth() + 1));
  // const monthStartOneDayEarly = new Date(monthStart.getTime() - 186400000); //开头前一天
  const monthEndOneDayExtra = new Date(monthEnd.getTime() + 86400000); //结尾多一天
  document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');
    calendar = new FullCalendar.Calendar(calendarEl, {
      headerToolbar: {
        left: 'prevYear,prev,next,nextYear today',
        center: 'title',
        // right: 'timeGridWeek'
        right: 'dayGridMonth'
      },
      locale: zhCn,
      // timeZone: "Asia/Shanghai",
      displayEventEnd: true,
      initialDate: new Date(),
      initialView: 'dayGridMonth',
      eventDisplay: 'block',
      navLinks: true, // can click day/week names to navigate views
      editable: true,
      dayMaxEvents: false, // allow "more" link when too many events
      // slotMinTime: '07:00:00',
      // slotMaxTime: '22:00:00',
      eventContent: modifiedEventContent,
      events: bookedEventsData,
      editable: false,
      eventClick: function(info) {
        let start = info.event.start;
        let end = info.event.end;
        let event = info.event.extendedProps;
        let dbId = event.dbId;
        let contact = event.contact;
        let courseType = event.course_type;
        let studentName = event.student_name;
        let targetScore = event.target_score;
        let deliverType = event.deliver_type;
        deleteEventPanel(start, end, event, dbId, contact, courseType, studentName, targetScore, deliverType);
      },
      selectable: true,
      select: function(info) {
        configCurrentDay = info.start;
        showConfigDayWindowPanelOne(1);
      },
    });

    var calendarEl2 = document.getElementById('calendar2');
    calendar2 = new FullCalendar.Calendar(calendarEl2, {
      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth'
      },
      locale: zhCn,
      initialDate: new Date(),
      displayEventEnd: true,
      eventDisplay: 'block',
      navLinks: true, // can click day/week names to navigate views
      // dayMaxEvents: true, // allow "more" link when too many events
      eventContent: modifiedAdminEventContent,
      events: adminEvents,
      editable: true,
      eventStartEditable: false,
      eventClick: function(info) {
        let realEvent = recoverDisplayEvent(info.event);
        removeSingleAdminEvent(realEvent.start, realEvent.end);
      },
      validRange: {
        start: veryStart,
          end: monthEnd
      },
      selectable: true,
      select: function(info) {
        configCurrentDay = info.start;
        //设置成一个初始值
        configCurrentDay.setHours("10");
        if (copyEvents.length !== 0) {
          finishCopyDay();
        } else {
          showConfigDayWindow(1);
        }
      },
      selectLongPressDelay: 1
    });
    prepareISOstr();
    prepareLoginForm();
    prepareAddDayEvent();
    prepareAddStudentCourseEvent();
    console.log(new Date())
    //如果上次登陆，不需要扫码
    if (uid)
      hideQrCode();
  });

  function modifiedEventContent(arg) {
    let event = arg.event;
    let start = new Date(event.start.getTime());
    let end = new Date(event.end.getTime());
    let startTime = start.getHours() + ':' + (start.getMinutes()<10?'0':'') + start.getMinutes();
    let endTime = end.getHours() + ':' + (end.getMinutes()<10?'0':'') + end.getMinutes();
    let timeSpan = startTime + "-" + endTime;
    let courseType = event.extendedProps.course_type;
    let deliverType = event.extendedProps.deliver_type ? event.extendedProps.deliver_type : "【可排课】";
    let name = event.extendedProps.student_name;
    return {
      html: 
      `<ul class="custom-event-single">  \
          <li class="course-type">${courseType}</li>    \
          <li class="name">${name}</li>  \
          <li class="deliver-type">${deliverType}</li> \
          <li class="time-span">${timeSpan}</li>   
      </ul>`
    }
  }

  function isoStrToChinaLocaleTime(ISOstr) {
    let china_datetime_str = new Date(ISOstr).toLocaleString("zh-cn", {timeZone: "Asia/Shanghai"});
    return china_datetime_str;
  }

  function localeStrToHrMin(localeStr) {
    let text = / (\d+:\d+):\d+/;
    let match = text.exec(localeStr)[1];
    return match;
  }

  function modifiedAdminEventContent(arg) {
    let event = arg.event;
    let start = new Date(event.start);
    let end = new Date(event.end);
    let startTime = start.getHours() + ':' + (start.getMinutes()<10?'0':'') + start.getMinutes();
    let endTime = end.getHours() + ':' + (end.getMinutes()<10?'0':'') + end.getMinutes();
    // startTime = localeStrToHrMin(isoStrToChinaLocaleTime(event.start));
    // endTime = localeStrToHrMin(isoStrToChinaLocaleTime(event.end));
    let timeSpan = startTime + "-" + endTime;
    let bookedStr = '';
    let eventRealTime = recoverDisplayEvent(arg.event);
    let classRmv = "can-remove";
    bookedEventsData.map(bookedEvent => {
      if (checkTimeOverlap(eventRealTime, bookedEvent)) {
        bookedStr = ' 已预约';
        classRmv = "cannot-remove";
      }
    })
    return {
      html: 
      `<span class=${classRmv}>${timeSpan}</span>${bookedStr}`
    }
  }

  function checkTimeOverlap(event, selectedEvent) {
    let timeOverlap = false;
    let s = new Date(event.start);
    let e = new Date(event.end);
    let start = new Date(selectedEvent.start); 
    let end = new Date(selectedEvent.end);
    if (start < e && start >= s) {
      timeOverlap = true;
    }
    if (end <= e && end > s) {
      timeOverlap = true;
    }
    return timeOverlap;
  }

  function avoidDouble(start, end) {
    let flag = true;
    for (let i = 0; i < adminEvents.length; i++) {
      let event = adminEvents[i];
      let s = new Date(event.start);
      let e = new Date(event.end);
        if (start < e && start >= s) {
          flag = false;
        }
        if (end <= e && end > s) {
          flag = false;
        }
    }
    return flag;
  }

  function prepareAddDayEvent() {
    let addDayEle = document.getElementById('config-day');
    addDayEle.addEventListener("submit", (event) => {
      event.preventDefault();
      let s = event.srcElement[1].value;
      let e = event.srcElement[4].value;
      addDay(s, e);
    });
  }

  function prepareAddStudentCourseEvent() {
    let addStudentCourse = document.getElementById('add-student-course');
    addStudentCourse.addEventListener("submit", (event) => {
      event.preventDefault();
      let start = event.srcElement[1].value;
      let name = event.srcElement[3].value;
      let contact = event.srcElement[4].value;
      let targetScore = event.srcElement[5].value;
      let courseType = event.srcElement[6].value;
      let deliverType = event.srcElement[7].value;
      document.getElementById('add-student-course-btn').disabled = true;
      addStudentEvent(start, name, contact, targetScore, courseType, deliverType);
    });
  }

  function addDay(s, e) {
    let startTime = document.getElementById('s-time').value;
    let endTime = document.getElementById('e-time').value;
    addAdminEvent(configCurrentDay, s, e);
    showConfigDayWindow(0);
  }

  function resetDay() {
    adminEvents = adminEvents.filter(event => {
      if (momentChinaTime(event.start).get('date') === momentChinaTime(configCurrentDay).get('date')) {
        calendar2.getEventById(event.id).remove();
      } else {
        return true;
      }
    });
    showConfigDayWindow(0);
  }

  function removeSingleAdminEvent(s, e) {
    // let answer = confirm(`
    //   确认删除 \n
    //   ${momentChinaTime(s).format('YYYY-MM-DD HH:mm:ss')} - ${momentChinaTime(e).format('YYYY-MM-DD HH:mm:ss')}
    // `)
    // if (answer == true) {
    //   console.log("ok")
    // }
    let eventRealTime = {
      start: s,
      end: e
    };
    let booked = false;
    let newEvents = [];
    let idToRmv = "";
    bookedEventsData.map(bookedEvent => {
      if (checkTimeOverlap(eventRealTime, bookedEvent)) {
        booked = true;
      }
    })
    if (!booked) {
      adminEvents = adminEvents.filter(event => {
        if (checkTimeOverlap(event, eventRealTime)) {
          idToRmv = event.id;
          calendar2.getEventById(idToRmv).remove();
        }
        return !checkTimeOverlap(event, eventRealTime);
      });
    }
    // calendar2.setOption('events', modifyDisplayEvents(newEvents));
    // calendar2.render();
  }

  function copyDay() {
    copyEvents = adminEvents.filter(event => {
      if (momentChinaTime(event.start).get('date') === momentChinaTime(configCurrentDay).get('date'))
        return true;
    });
    showConfigDayWindow(0);
    if (copyEvents.length !== 0) {
      var element = document.getElementById("calendar2");
      element.classList.add("active");
    }
  }

  function finishCopyDay() {
    resetDay(); 
    copyEvents = copyEvents.map(event => {
      let start = momentChinaTime(event.start);
      let end = momentChinaTime(event.end);
      start.set("month", configCurrentDay.getMonth()); 
      start.set("date", configCurrentDay.getDate()); 
      end.set("month", configCurrentDay.getMonth());
      end.set("date", configCurrentDay.getDate());
      let newEvent = {};
      newEvent.start = start.toISOString();
      newEvent.end = end.toISOString();
      newEvent.id = new Date().valueOf() + Math.round(Math.random() * 100);
      bookedEventsData.map(bookedEvent => {
        if (checkTimeOverlap(newEvent, bookedEvent)) {
          newEvent.color = "#29b80d";
        }
      })
      calendar2.addEvent(modifyDisplayEvent(newEvent));
      calendar2.render();
      return newEvent;
    })
    adminEvents = adminEvents.concat(copyEvents);
    copyEvents = [];
    var element = document.getElementById("calendar2");
    element.classList.remove("active");
  }

  function showConfigDayWindow(option) {
    if (option === 1) {
      let calendar2Ele = document.getElementById('calendar2');
      calendar2Ele.setAttribute("style","opacity:20%;pointer-events:none;");
      let configDay = document.getElementById("config-day");
      configDay.setAttribute("style","display:flex");
    } else if (option === 0) {
      let calendar2Ele = document.getElementById('calendar2');
      calendar2Ele.setAttribute("style","opacity:100%;pointer-events:auto;");
      let configDay = document.getElementById("config-day");
      configDay.setAttribute("style","display:none");
    }
  }

  function showConfigDayWindowPanelOne(option) {
    displayAddStudentEventPanel();
    if (option === 1) {
      let calendarEle = document.getElementById('calendar');
      calendarEle.setAttribute("style","opacity:20%;pointer-events:none;");
      let configDay = document.getElementById("config-day-1");
      configDay.setAttribute("style","display:flex");
      let addStudentDay = document.getElementById("add-student-course");
      addStudentDay.setAttribute("style","display:grid");
    } else if (option === 0) {
      let calendarEle = document.getElementById('calendar');
      calendarEle.setAttribute("style","opacity:100%;pointer-events:auto;");
      let configDay = document.getElementById("config-day-1");
      configDay.setAttribute("style","display:none");
      let addStudentDay = document.getElementById("add-student-course");
      addStudentDay.setAttribute("style","display:none");
    }
  }

  function displayAddStudentEventPanel() {
    let bookPanel = document.getElementById("book-panel");
    bookPanel.setAttribute("style", "display: block");
  }

  function prepareISOstr() {
    startISOstr = new Date(monthStart.getTime());
    startISOstr.setHours(0);
    startISOstr.setMinutes(0);
    startISOstr.setSeconds(0);
    startISOstr = startISOstr.toISOString();
    endISOstr = new Date(monthEndOneDayExtra.getTime());
    endISOstr.setHours(0);
    endISOstr.setMinutes(0);
    endISOstr.setSeconds(0);
    endISOstr = endISOstr.toISOString();
    veryStartISOstr = new Date(veryStart.getTime());
    veryStartISOstr.setHours(0);
    veryStartISOstr.setMinutes(0);
    veryStartISOstr.setSeconds(0);
    veryStartISOstr = veryStartISOstr.toISOString();
  }

  function download(filename, text) {
    var element = document.createElement('a');
    element.setAttribute('href', 'data:text/csv;charset=utf-8,' + encodeURIComponent(text));
    element.setAttribute('download', filename);
    element.style.display = 'none';
    document.body.appendChild(element);
    element.click();
    document.body.removeChild(element);
  }

  function downloadBookedEvents() {
    let file = convertCourseJSONToCSV(bookedEventsData);
    download('default', file);
  }

  function loadPanel(option) {
    let loader = document.getElementById("loader");
    loader.setAttribute("style","display:block");
    faunaGetBookedEventsCurrentMonth(veryStartISOstr, endISOstr)
    .then(events => {
      let clsEvents = []
      calendar.setOption('events', []);
      calendar.render();
      for (let i = 0; i < events.length; i++) {
        let event = events[i].data;
        event['dbId'] = events[i].ref.value.id;
        event['start'] = event.start.value;
        event['end'] = event.end.value;
        event['color'] = assignColorSingleEvent(event.course_type, event.end);
        if (!courseTypeList.includes(event.course_type)) {
          courseTypeList.push(event.course_type);
        }
        if (!studentNameList.includes(event.student_name)) {
          studentNameList.push(event.student_name);
        }
        clsEvents.push(event);
      }
      bookedEventsData = JSON.parse(JSON.stringify(clsEvents));
      // console.log(bookedEventsData)
      onlyLoadAdminEvents().then(emptySlots => {
        let calendarEl = document.getElementById('summary-panel');
        calendarEl.setAttribute("style","display:block");
        let displayEvents = clsEvents.concat(emptySlots);
        calendar.setOption('events', modifyDisplayEvents(displayEvents));
        calendar.render();
        if (option === 0) {
          setupSubmitBtn();
          setupFilter();
        }
        let loader = document.getElementById("loader");
        loader.setAttribute("style","display:none");
      })
    });
  }

  function loadPanelWithFilter(courseType, studentName) {
    let loader = document.getElementById("loader");
    loader.setAttribute("style","display:block");
    faunaGetBookedEventsCurrentMonth(veryStartISOstr, endISOstr)
    .then(events => {
      let filteredEvents = []
      for (let i = 0; i < events.length; i++) {
        let event = events[i].data;
        event['dbId'] = events[i].ref.value.id;
        event['start'] = event.start.value;
        event['end'] = event.end.value;
        event['color'] = assignColorSingleEvent(event.course_type, event.end);
        if (courseType === "所有课程") {
          if (studentName === "所有学员") {
            filteredEvents.push(event);
          } else {
            if (event.student_name === studentName) {
              filteredEvents.push(event);
            }
          }
        } else {
          if (studentName === "所有学员") {
            if (event.course_type === courseType) {
              filteredEvents.push(event);
            }
          }
        }
        if (courseType !== "所有课程" && studentName !== "所有学员") {
          if (event.course_type === courseType && event.student_name === studentName) {
            filteredEvents.push(event);
          }
        }
      }
      onlyLoadAdminEvents().then(emptySlots => {
        let calendarEl = document.getElementById('summary-panel');
        calendarEl.setAttribute("style","display:block");
        let displayEvents = [];
        if (courseType === "所有课程" && studentName === "所有学员") {
          displayEvents = filteredEvents.concat(emptySlots);
        } else {
          displayEvents = filteredEvents;
        }
        calendar.setOption('events', modifyDisplayEvents(displayEvents));
        calendar.render();
        let loader = document.getElementById("loader");
        loader.setAttribute("style","display:none");
        document.getElementById("calendar").setAttribute("style", "opacity:100%");
      })
    });
  }

  function assignColorSingleEvent(courseType, end) {
    let et = new Date(end);
    if (et - new Date() < 0) {
      return "#6e6e6e";
    }
    let colors = ["#c41b67", "#9328a8", "#285ba8", "#4ba828", "#e89c0e"]
    if (courseType === "mock分析") {
      return colors[0];
    } else if (courseType === "口语") {
      return colors[1];
    } else if (courseType === "听力") {
      return colors[2];
    } else if (courseType === "阅读") {
      return colors[3];
    } else if (courseType === "写作") {
      return colors[4];
    }
  }

  function adminPanel() {
    let linkNode = document.getElementsByTagName('link')[1];
    linkNode.disabled = false;
    let body = document.getElementsByClassName("align")[0];
    body.classList.add("tutor-v");
    let loader = document.getElementById("loader");
    loader.setAttribute("style", "display:block");
    loadAdminEvents();
    let summary = document.getElementById("summary-panel");
    summary.setAttribute("style","display:none");
  }

  function addAdminEvent(date, start, end) {
    let hrMinStart = start.split(":");
    let hrMinEnd = end.split(":");
    let startTime = setMomentHrMinSec(momentChinaTime(date), hrMinStart[0], hrMinStart[1], "0");
    let endTime = setMomentHrMinSec(momentChinaTime(date), hrMinEnd[0], hrMinEnd[1], "0");
    if (endTime - startTime >= 3600 * 1000 && avoidDouble(startTime, endTime)) {
      if ((endTime - startTime) / 1000 % 3600 === 0) {
        let hours = (endTime - startTime) / 1000 / 3600;
        let s = startTime.clone();
        let e = startTime.clone();
        for (let i = 0; i < hours; i++) {
          let id = new Date().valueOf() + Math.round(Math.random() * 100);
          e.set('hours', e.get('hours') + 1);
          let event = {
            "id": id,
            "title": "",
            "contact": "",
            "start": s.toISOString(),
            "end": e.toISOString()
          };
          bookedEventsData.map(bookedEvent => {
            if (checkTimeOverlap(event, bookedEvent)) {
              event.color = "#29b80d";
            }
          })
          s.set('hours', s.get('hours') + 1);
          // s.setMinutes(e.getMinutes() + 1);    //额外加1分钟
          e = s.clone();
          adminEvents.push(event);
          calendar2.addEvent(modifyDisplayEvent(event));
        }
      }
    }
    calendar2.render();
  }

  function addStudentEvent(start, name, contact, targetScore, courseType, deliverType) {
    let id = new Date().valueOf() + Math.round(Math.random() * 100);
    let hrStart = start.split(":");
    let startTime = new Date(configCurrentDay);
    startTime.setHours(hrStart[0]);
    startTime.setMinutes(hrStart[1]);
    startTime.setSeconds("0");
    let endTime = new Date(startTime);
    endTime = new Date(endTime.setHours(endTime.getHours() + 1));
    let event = {
      "id": id,
      "student_name": name,
      "contact": contact,
      "target_score": targetScore,
      "course_type": courseType,
      "deliver_type": deliverType,
      "start": new Date(startTime).toISOString(),
      "end": new Date(endTime).toISOString()
    };


    let eventChinaTZ = recoverDisplayEvent(event);
    avoidDoubleBook([eventChinaTZ])
    .then(res => {
      if (res) {
        if (avoidDouble(new Date(eventChinaTZ.start), new Date(eventChinaTZ.end))) {
          console.log(eventChinaTZ)
          faunaAddEvent(eventChinaTZ);
        } 
        finishAddStudentEvent(eventChinaTZ);
      } else {
        document.getElementById('add-student-course-btn').disabled = false;
        showConfigDayWindowPanelOne(0);
      }
    })
  }

  async function avoidDoubleBook(selectedEvents) {
    return new Promise(resolve => {
      faunaGetBookedEventsCurrentMonth(startISOstr, endISOstr)
      .then(events => {
        let flag = true;
        events.map(event => {
          let newEvent = JSON.parse(JSON.stringify(event));
          selectedEvents.map(selectedEvent => {
            newEvent.data.start = event.data.start.value;
            newEvent.data.end = event.data.end.value;
            if (checkTimeOverlap(newEvent.data, selectedEvent)) {
              flag = false;
            }
          })
        })
        return resolve(flag);
      })
    })
  }

  function checkTimeOverlap(event, selectedEvent) {
    let timeOverlap = false;
    let s = new Date(event.start);
    let e = new Date(event.end);
    let start = new Date(selectedEvent.start); 
    let end = new Date(selectedEvent.end);
    if (start < e && start >= s) {
      timeOverlap = true;
    }
    if (end <= e && end > s) {
      timeOverlap = true;
    }
    return timeOverlap;
  }

  function setUpTimeConfigDay(date, s_h, s_m, s_s, e_h, e_m, e_s) {
    let startTime = new Date(date);
    let endTime = new Date(date);
    startTime.setHours(s_h);
    startTime.setMinutes(s_m);
    startTime.setSeconds(s_s);
    endTime.setHours(e_h);
    endTime.setMinutes(e_m);
    endTime.setSeconds(e_s);

    let momentStartTime = momentChinaTime(date);
    let momentEndTime = momentChinaTime(date);
    let chinaStartTime = setMomentHrMinSec(momentStartTime, s_h, s_m, s_s).toDate();
    let chinaEndTime = setMomentHrMinSec(momentEndTime, e_h, e_m, e_s).toDate();

    return [startTime, endTime, chinaStartTime, chinaEndTime];
  }

  function finishAddStudentEvent(event) {
    faunaBookEvent(event).then(res => {
      let s = new Date(res.data.start.value).toLocaleString("zh-cn");
      let e = new Date(res.data.end.value).toLocaleString("zh-cn");
      let studentName = res.data.student_name;
      let courseType = res.data.course_type;
      let deliverType = res.data.deliver_type;
      let timeStr = `${s} 至 ${e}`;
      let strTutor = `${studentName}成功预约了${timeStr}的${courseType}课程, 授课形式:${deliverType}, 
                      目标分: ${res.data.target_score}, 联系方式: ${res.data.contact}`;
      sendTutorMsg(strTutor);
      document.getElementById('add-student-course-btn').disabled = false;
      loadPanel(1);
      showConfigDayWindowPanelOne(0);
    })
  }

  function sendTutorMsg(msg) {
    faunaGetTutors()
    .then(tutors => {
      tutors.map(tutor => {
        pushWxMessage(tutor.data.uid, msg, "https://lingyang-au-pte.com/tutor-view.html");
      })
    })
  }

  function saveConfig() {
    if (copyEvents.length !== 0)
      return;
  }

  function redirectVisitor() {
    let path = location.pathname;
    let prefix = path.substring(0,path.lastIndexOf('/'));
    window.location.href= prefix + '/index.html';
  }

  function prepareLoginForm() {
    const form = document.getElementById('login-form');
    form.addEventListener('submit', (event) => {
      event.preventDefault();
      let tutorname = event.srcElement[0].value;
      let username = event.srcElement[1].value;
      let password = event.srcElement[2].value;
      login(tutorname, username, password);
    });
  }

  function login(tutorname, username, password) {
    let loginPanel = document.getElementById("login-panel");
    let loader = document.getElementById("loader");
    // let calendarEl = document.getElementById("calendar");
    loginPanel.setAttribute("style","display:none");
    loader.setAttribute("style","display:block");
    faunaFindItemByValue('user', 'username', username)
    .then((res) => {
      if (Object.keys(res).length != 0) {
        let pw = res.data.password;
        if (password == pw) {
          let linkNode = document.getElementsByTagName('link')[1];
          linkNode.disabled = true;
          prepareUserProfile(tutorname);
          loadPanel(0);
        } else {
          appendAlertInfo("登陆失败，用户名密码不正确")
          loginPanel.setAttribute("style","display:block");
          loader.setAttribute("style","display:none");
        }
      } else {
        appendAlertInfo("登陆失败，用户名密码不正确");
        loginPanel.setAttribute("style","display:block");
        loader.setAttribute("style","display:none");
      }
    });
  }

  function deleteEventPanel(start, end, event, dbId, contact, courseType, studentName, targetScore, deliverType) {
    if (dbId) {
      let deletePanel = document.getElementById("delete-panel");
      document.getElementById("calendar").setAttribute("style", "opacity:10%");
      deletePanel.setAttribute("style", "display: flex");
      let spans = deletePanel.querySelectorAll('span');
      spans[0].innerHTML = start.toLocaleString("zh-cn");
      spans[1].innerHTML = end.toLocaleString("zh-cn");
      spans[2].innerHTML = courseType;
      spans[3].innerHTML = deliverType;
      spans[4].innerHTML = studentName;
      spans[5].innerHTML = contact;
      spans[6].innerHTML = targetScore;
      dbIdToDelete = dbId;
      let deleteEventEle = document.getElementById("delete-event-btn");
    }
  }

  function exitDeletePanel() {
    let deletePanel = document.getElementById("delete-panel")
    deletePanel.setAttribute("style", "display: none");
    document.getElementById("calendar").setAttribute("style", "opacity:100%");
  }

  function deleteEvent() {
    faunaDeleteEvent(dbIdToDelete)
    .then(res => {
      let s = new Date(res.data.start.value).toLocaleString("zh-cn");
      let e = new Date(res.data.end.value).toLocaleString("zh-cn");
      let studentUid = res.data.student_uid;
      let studentName = res.data.student_name;
      let courseType = res.data.course_type;
      let timeStr = `${s} 至 ${e}`;
      let strStudent = `【预约取消通知】${studentName}同学, 您预约${timeStr}的${courseType}课程已取消！如该操作有误，请尽快联系领洋客服处理`;
      let strTutor = `【预约取消通知】${studentName}同学预约${timeStr}的${courseType}课程已取消！`;
      pushWxMessage(studentUid, strStudent, "https://lingyang-au-pte.com");
      sendTutorMsg(strTutor);
      loadPanel(1);
      exitDeletePanel();
    });
  }



  function returnBack() {
    if (copyEvents.length !== 0)
      return;
    let body = document.getElementsByClassName("align")[0];
    body.classList.remove("tutor-v");
    calendar2.removeAllEvents();
    let adminPanel = document.getElementById("admin-panel");
    adminPanel.setAttribute("style", "display:none");
    let linkNode = document.getElementsByTagName('link')[1];
    linkNode.disabled = true;
    loadPanel(1);
  }

  function setupSubmitBtn() {
    let topEle = document.getElementsByClassName("fc-header-toolbar fc-toolbar fc-toolbar-ltr")[0];
    let submitBtn = document.createElement("button");
    submitBtn.innerHTML = "提交选课";
    submitBtn.className = "fc-timeGridWeek-button fc-button fc-button-primary fc-button-active";

    let hamburger = document.createElement("a");
    hamburger.className = "hamburger-menu";
    hamburger.id = "hamburger-menu";
    let child1 = document.createElement("div");
    child1.className = "bar-top";
    let child2 = document.createElement("div");
    child2.className = "bar-middle";
    let child3 = document.createElement("div");
    child3.className = "bar-bottom";
    hamburger.appendChild(child1);
    hamburger.appendChild(child2);
    hamburger.appendChild(child3);
    topEle.appendChild(hamburger);
    hamburger.setAttribute("onclick", "hamburgerMenu()");
  } 

  function hamburgerMenu() {
    document.getElementById("calendar").setAttribute("style", "opacity:15%");
    document.getElementById("manage-btns").setAttribute("style", "display:flex");
  }

  function exitHamburgerMenu() {
    document.getElementById("calendar").setAttribute("style", "opacity:100%");
    document.getElementById("manage-btns").setAttribute("style", "display:none");
  }

  function setupFilter() {
    let filterGroup = document.getElementById("filter-group");

    let label1 = document.createElement("label");
    label1.for = "filter-course-type";
    label1.innerHTML = "过滤器 - 课程内容";

    let filter1 = document.createElement("select");
    filter1.id = "filter-course-type";
    filter1.size = 6;
    filter1.name = "filter-course-type";

    let filter1_option1 = document.createElement("option");
    filter1_option1.text = "所有课程";
    filter1_option1.selected = "selected";
    filter1.appendChild(filter1_option1);
    courseTypeList.map(courseType => {
      let filter1_option = document.createElement("option");
      filter1_option.text = courseType;
      filter1.appendChild(filter1_option);
    })

    let label2 = document.createElement("label");
    label2.for = "filter-student-name";
    label2.innerHTML = "过滤器 - 学员名称";

    let filter2 = document.createElement("select");
    filter2.id = "filter-student-name";
    filter2.size = 6;
    filter2.name = "filter-student-name";

    let filter2_option1 = document.createElement("option");
    filter2_option1.text = "所有学员";
    filter2_option1.selected = "selected";
    filter2.appendChild(filter2_option1);
    studentNameList.map(studentName => {
      let filter2_option = document.createElement("option");
      filter2_option.text = studentName;
      filter2.appendChild(filter2_option);
    })

    filterGroup.insertBefore(filter2, filterGroup.firstChild);
    filterGroup.insertBefore(label2, filterGroup.firstChild);
    filterGroup.insertBefore(filter1, filterGroup.firstChild);
    filterGroup.insertBefore(label1, filterGroup.firstChild);
  }

  function filter() {
    setTimeout(() => {
      document.getElementById("calendar").setAttribute("style", "opacity:10%");
    }, 100)
    document.getElementById("filter-group").setAttribute("style", "display: flex");
  }

  function saveFilter() {
    document.getElementById("filter-group").setAttribute("style", "display: none");
    let filter1 = document.getElementById("filter-course-type");
    let filter2 = document.getElementById("filter-student-name");

    filterCourseType = filter1.options[filter1.selectedIndex].text;
    filterStudentName = filter2.options[filter2.selectedIndex].text;
    loadPanelWithFilter(filterCourseType, filterStudentName);
  }

  function appendSuccessInfo() {
    let element = document.getElementById("admin-messages");
    let listItem = document.createElement("li");
    listItem.innerHTML = "管理数据保存成功!";
    element.appendChild(listItem);
    setTimeout(() => {
      element.removeChild(listItem);
    }, 3000);
  }

  function appendAlertInfo(message) {
    let element = document.getElementById("admin-messages");
    let listItem = document.createElement("li");
    listItem.innerHTML = message;
    listItem.setAttribute("style", "color:#c42525 !important");
    element.appendChild(listItem);
    setTimeout(() => {
      element.removeChild(listItem);
    }, 3000);
  }

  function createQrCodeHtml() {
    document.getElementById("loader").setAttribute("style", "display: block"); 
    document.getElementById('login-btn-ini').setAttribute("style", "display: none");
    document.getElementById("login-panel-title").setAttribute("style", "display:none");
    createQrCode()
    .then(res => {
      document.getElementById("qr-code").setAttribute("src",res.url);
      code = res.code;
      constantQuery();
    })
    .catch(err => {
      qrCodeNotLoaded();
    })
  }

  function qrCodeLoaded() {
    document.getElementById("loader").setAttribute("style", "display: none"); 
    document.getElementById("qr-info").setAttribute("style", "display:block");
    document.getElementById("login-panel-title").setAttribute("style", "display:block;margin-bottom:-30px");
    document.getElementById("wechat-icon").setAttribute("style","display:block; position:relative; top:150px;");
    document.getElementById("login-btn-ini").setAttribute("style","display:none");
  }

  function qrCodeNotLoaded() {
    document.getElementById("loader").setAttribute("style", "display: none"); 
    document.getElementById("login-btn-ini").setAttribute("style","display:block");
    document.getElementById("login-panel-title").setAttribute("style", "display:block");
  }

  function constantQuery() {
      let flag = 1;
      let query = setInterval(() => {
          flag += 1;
          queryWxPusher(code).then(res => {
              if (res.code === 1000) {
                  uid = res.data;
                  let message = "您已成功登录！如果是微信手机页面登录，页面不会自动跳转，请手动退回至上一个界面";
                  pushWxMessage(uid, message, "https://lingyang-au-pte.com");
                  hideQrCode();
                  clearInterval(query);
              }
          })
          if (flag > 18) {
              document.getElementById("qr-expire").setAttribute("style", "display:block");
              document.getElementById("qr-info").setAttribute("style", "display:none");
              clearInterval(query);
          }
      }, 10000);
  }

  function hideQrCode() {
    document.getElementById("qr-code-panel").setAttribute("style","display:none");
    faunaFindItemByValue('tutor', 'uid', uid)
    .then(res => {
      if (JSON.stringify(res) !== JSON.stringify({})) {
        tutor_name = res.data.tutor_name;
        document.getElementById("loader").setAttribute("style","display:block");
        let linkNode = document.getElementsByTagName('link')[1];
        linkNode.disabled = true;
        loadPanel(0);
        localStorage.setItem('tutor_uid', uid);
      } else {
        document.getElementById("login-panel").setAttribute("style","display:block");
      }
    });
  }

  function prepareUserProfile(name) {
    let tutor = {tutor_name: name, uid: uid};
    faunaAddTutor(tutor);
  }

  function setupSaveBtn() {
    let parent = document.getElementById("calendar2");
    let topEle = parent.querySelector('.fc-header-toolbar.fc-toolbar.fc-toolbar-ltr');
    let submitBtn = document.createElement("button");
    submitBtn.innerHTML = "保存";
    submitBtn.className = "fc-timeGridWeek-button fc-button fc-button-primary fc-button-active";
    submitBtn.id = "admin-save-btn";
    topEle.appendChild(submitBtn);
    submitBtn.setAttribute("onclick", "adminSave()");
    saveBtnAdded = true;
  }

  function adminSave() {
    let adminSaveBtn = document.getElementById("admin-save-btn");
    adminSaveBtn.disabled = true;
    let adminEventsToSave = [];
    adminEvents.map( event => {
      let eventToSave = {};
      eventToSave.start = event.start;
      eventToSave.end = event.end;
      eventToSave.id = event.id;
      adminEventsToSave.push(eventToSave);
    })
    //修改回去
    faunaAddEvents(JSON.parse(JSON.stringify(adminEventsToSave)), 
                   adminEventsLen,
                   veryStartISOstr, 
                   endISOstr)
    .then(res => {
      adminSaveBtn.disabled = false;
      appendSuccessInfo();
    })
    .catch(err => {
      appendAlertInfo("数据保存失败");
    })
  }

  function hideLoaderShowAdmin() {
    let loader = document.getElementById("loader");
    loader.setAttribute("style", "display:none");
    let adminPanel = document.getElementById("admin-panel");
    adminPanel.setAttribute("style", "display:block");
  }

  function loadAdminEvents() {
    adminEvents = [];
    faunaGetEventsCurrentMonth(veryStartISOstr, endISOstr)
    .then(events => {
      hideLoaderShowAdmin();
      events.map(event => {
        let newEvent = event.data;
        newEvent.start = newEvent.start.value;
        newEvent.end = newEvent.end.value;
        bookedEventsData.map(bookedEvent => {
          if (checkTimeOverlap(newEvent, bookedEvent)) {
            newEvent.color = "#29b80d";
          }
        })
        adminEvents.push(newEvent);
      })
      adminEventsLen = adminEvents.length;
      calendar2.setOption('events', modifyDisplayEvents(adminEvents));
      calendar2.render();
      if (!saveBtnAdded) 
        setupSaveBtn();
    })
  }

  async function onlyLoadAdminEvents() {
    return new Promise(resolve => {
      adminEvents = [];
      let overlappedEvents = [];
      faunaGetEventsCurrentMonth(startISOstr, endISOstr)
      .then(events => {
        events.map(event => {
          let newEvent = event.data;
          newEvent.start = newEvent.start.value;
          newEvent.end = newEvent.end.value;
          bookedEventsData.map(bookedEvent => {
            if (checkTimeOverlap(newEvent, bookedEvent)) {
              overlappedEvents.push(newEvent);
            }
          })
          adminEvents.push(newEvent);
        })
        let emptySlots = adminEvents.filter(item => !overlappedEvents.includes(item));
        // emptySlots.map(slot => {
          // slot.color = "#29b80d";
        // })
        return resolve(emptySlots);
      })
    });
  }

  function convertCourseJSONToCSV(arr) {
    let newArr = [];
    for (let i = 0; i < arr.length; i++) {
      let start = new Date(arr[i].start).toLocaleString("zh-cn", {timeZone: "Asia/Shanghai"});
      let end = new Date(arr[i].end).toLocaleString("zh-cn", {timeZone: "Asia/Shanghai"});
      let e = {
        'id': arr[i].student_uid,
        '名字': arr[i].student_name,
        '授课类型': arr[i].course_type,
        '目标分数': arr[i].target_score,
        '联系方式': arr[i].contact,
        '开始时间': start,
        '结束时间': end,
      };
      newArr.push(e);
    }

    const array = [Object.keys(newArr[0])].concat(newArr)

    return array.map(it => {
      return Object.values(it).toString()
    }).join('\n')
  }
</script>
</head>

<body class="align">
  <div id="summary-panel" style="display:none">
    <div id='calendar'></div>
    <div id="config-day-1">
      <div class="grid" id="book-panel" style="display: none;">
        <div style="text-align: center;">
          手动添加课程信息
        </div>
        <ul id="course-profile"></ul>
        <form class="form login" id="add-student-course">
          <div class="form__field">
            <div style="display:flex; flex-direction:row; margin:auto;" class="top-level">
              <fieldset style="padding:0 5px">
                <input type="time" min="05:00" max="22:00" required>
              </fieldset>
              <fieldset style="padding:0 0">
                - 1小时
              </fieldset>
            </div>
          </div>
          <div class="form__field">
            <label for="studentname"><span>学员姓名</span></label>
            <input id="studentname" type="text" placeholder="请填写姓名" maxlength="20" required>
          </div>
          <div class="form__field">
            <label for="contact"><span>联系方式</span></label>
            <input id="contact" type="text" placeholder="请填写联系方式" maxlength="20" required>
          </div>
          <div class="form__field">
            <label for="targetscore"><span>目标分数</span></label>
            <input id="targetscore" type="text" placeholder="请填写目标分数" maxlength="20" required>
          </div>
          <div class="form__field">
            <label for="course-type"><span>预约类型</span></label>
            <select id="course-type" required>
              <option value="">请选择预约类型</option>
              <option value="mock分析">mock分析</option>
              <option value="口语">口语</option>
              <option value="听力">听力</option>
              <option value="阅读">阅读</option>
              <option value="写作">写作</option>
            </select>
          </div>
          <div class="form__field">
            <label for="deliver-type"><span>授课形式</span></label>
            <select id="deliver-type" required>
              <option value="Zoom">Zoom</option>
              <option value="腾讯会议">腾讯会议</option>
            </select>
          </div>
          <div style="margin-top: 10px;">
            <div class="form__field" style="float:right;">
              <input type="submit" id="add-student-course-btn" value="提交" />
            </div>
            <div class="form__field" style="float:left; width:45%;">
              <input type="button" class="return" id="exit-btn" onclick="showConfigDayWindowPanelOne(0)" value="返回" />
            </div>
          </div>
        </form>
      </div>
    </div>
    <div id="manage-btns" onclick="exitHamburgerMenu()">
      <button onclick='adminPanel()' class="fc-button fc-button-primary fc-button-active" id="manage-btn">进入课时管理界面</button>
      <button onclick='filter()' class="fc-button fc-button-primary fc-button-active" id="filter-btn">过滤器</button>
      <button onclick='downloadBookedEvents()' class="fc-button fc-button-primary fc-button-active" id="export-btn">导出数据</button>
    </div>
    <div id="filter-group">
      <button onclick='saveFilter()' class="fc-button fc-button-primary fc-button-active" id="filter-btn-confirm">确认</button>
    </div>
    <div id="delete-panel" onclick="exitDeletePanel()">
      <div><span>placeholder1</span> - <span>placeholder2</span></div>
      <div><strong>授课内容: </strong><span>placeholder3</span></div>
      <div><strong>授课形式: </strong><span>placeholder4</span></div>
      <div><strong>学员名称: </strong><span>placeholder5</span></div>
      <div><strong>联系方式: </strong><span>placeholder6</span></div>
      <div><strong>目标分数: </strong><span>placeholder7</span></div>
      <button onclick="deleteEvent()" class="fc-button fc-button-primary fc-button-active">取消预约</button>
    </div>
  </div>
  <div id="qr-code-panel" style="display:flex; flex-direction: column; align-items: center;">
    <div id="login-panel-title">
      欢迎使用在线约课管理系统
    </div>
    <img id="wechat-icon" width="50px" style="display:none" src="assets/wechat-icon.png">
    <button class="btn-normal" id="login-btn-ini" style="margin:20px 0;cursor: pointer;" onclick="createQrCodeHtml()">登陆</button>
    <img id="qr-code" width="250px" src="" onload="qrCodeLoaded()">
    <span id="qr-info" style="display:none;">扫码后等待5秒左右，自动跳转</span>
    <span id="qr-expire" style="display:none;">已过期，请刷新页面重新扫码</span>
  </div>

  <div class="grid" id="login-panel" style="display:none">
    <div id="login-panel-title">
      请输入您的姓名, 管理员用户名，密码
    </div>
    <form class="form login" id="login-form">
      <div class="form__field">
        <label for="login__tutorname"><svg class="icon">
            <use xlink:href="#icon-user"></use>
          </svg><span class="hidden">姓名</span></label>
        <input autocomplete="tutorname" id="login__tutorname" type="text" name="tutorname" class="form__input" placeholder="姓名" required>
      </div>

      <div class="form__field">
        <label for="login__username"><svg class="icon">
            <use xlink:href="#icon-user"></use>
          </svg><span class="hidden">用户名</span></label>
        <input autocomplete="username" id="login__username" type="text" name="username" class="form__input" placeholder="用户名" required>
      </div>

      <div class="form__field">
        <label for="login__password"><svg class="icon">
            <use xlink:href="#icon-lock"></use>
          </svg><span class="hidden">密码</span></label>
        <input id="login__password" type="password" name="password" class="form__input" placeholder="密码" required>
      </div>

      <div class="form__field">
        <input type="submit" id="login-btn" value="登陆">
      </div>
    </form>
    <!-- <p class="text--center">还不是成员? <a href="#">点此注册</a> <svg class="icon">
        <use xlink:href="#icon-arrow-right"></use>
      </svg></p> -->
  </div>

  <div class="loader loader--style1" id="loader" style="display:none" title="0">
    <svg version="1.1" id="loader-1" x="0px" y="0px"
    width="80px" height="80px" viewBox="0 0 40 40" enable-background="new 0 0 40 40" xml:space="preserve">
      <path opacity="0.2" fill="#000" d="M20.201,5.169c-8.254,0-14.946,6.692-14.946,14.946c0,8.255,6.692,14.946,14.946,14.946
        s14.946-6.691,14.946-14.946C35.146,11.861,28.455,5.169,20.201,5.169z M20.201,31.749c-6.425,0-11.634-5.208-11.634-11.634
        c0-6.425,5.209-11.634,11.634-11.634c6.425,0,11.633,5.209,11.633,11.634C31.834,26.541,26.626,31.749,20.201,31.749z"/>
      <path fill="#000" d="M26.013,10.047l1.654-2.866c-2.198-1.272-4.743-2.012-7.466-2.012h0v3.312h0
        C22.32,8.481,24.301,9.057,26.013,10.047z">
        <animateTransform attributeType="xml"
          attributeName="transform"
          type="rotate"
          from="0 20 20"
          to="360 20 20"
          dur="0.5s"
          repeatCount="indefinite"/>
        </path>
    </svg>
  </div>

  <svg class="icons" style="display:none">
    <symbol id="icon-arrow-right" viewBox="0 0 1792 1792">
      <path d="M1600 960q0 54-37 91l-651 651q-39 37-91 37-51 0-90-37l-75-75q-38-38-38-91t38-91l293-293H245q-52 0-84.5-37.5T128 1024V896q0-53 32.5-90.5T245 768h704L656 474q-38-36-38-90t38-90l75-75q38-38 90-38 53 0 91 38l651 651q37 35 37 90z" />
    </symbol>
    <symbol id="icon-lock" viewBox="0 0 1792 1792">
      <path d="M640 768h512V576q0-106-75-181t-181-75-181 75-75 181v192zm832 96v576q0 40-28 68t-68 28H416q-40 0-68-28t-28-68V864q0-40 28-68t68-28h32V576q0-184 132-316t316-132 316 132 132 316v192h32q40 0 68 28t28 68z" />
    </symbol>
    <symbol id="icon-user" viewBox="0 0 1792 1792">
      <path d="M1600 1405q0 120-73 189.5t-194 69.5H459q-121 0-194-69.5T192 1405q0-53 3.5-103.5t14-109T236 1084t43-97.5 62-81 85.5-53.5T538 832q9 0 42 21.5t74.5 48 108 48T896 971t133.5-21.5 108-48 74.5-48 42-21.5q61 0 111.5 20t85.5 53.5 62 81 43 97.5 26.5 108.5 14 109 3.5 103.5zm-320-893q0 159-112.5 271.5T896 896 624.5 783.5 512 512t112.5-271.5T896 128t271.5 112.5T1280 512z" />
    </symbol>
  </svg>


  <div id="admin-panel" style="display: none">
    <div id='calendar2' style="display:flex">
      <button style="margin:10px 0" onclick='returnBack()' class="fc-button fc-button-primary fc-button-active">返回课程表</button>
      <ul id="admin-messages"></ul>
    </div>
    <div id="config-day-window">
      <form id="config-day" autocomplete="off">
        <div style="display:flex; flex-direction:row;" class="top-level">
          <fieldset style="padding:0 5px">
            <input id="s-time" type="time" name="s-time" min="00:00" max="24:00" required>
          </fieldset>
          <fieldset style="padding:0 0">
            至
          </fieldset>
          <fieldset style="padding:0 5px">
            <input id="e-time" type="time" name="e-time" min="00:00" max="24:00" required>
          </fieldset>
        </div>
        <div style="display:flex; flex-direction:row;" class="bottom-level">
          <fieldset>
            <input type="submit" style="width:80px;cursor:pointer;" id="add-day" value="添加时间">
          </fieldset>
          <fieldset>
            <input onclick="copyDay()" type="button" id="copy-day" style="cursor:pointer;" value="复制">
          </fieldset>
          <!-- <fieldset>
            <input onclick="resetDay()" type="button" id="reset-day" style="cursor:pointer;" value="重置">
          </fieldset> -->
          <fieldset>
            <input onclick="showConfigDayWindow(0);" id="config-window-back" type="button" value="返回">
          </fieldset>
        </div>
      </form>
    </div>
  </div>

</body>
</html>
